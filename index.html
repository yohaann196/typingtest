<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Typing Test</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;500;700&display=swap" rel="stylesheet">

<style>
body {
  margin: 0;
  min-height: 100vh;
  background-color: #111827;
  color: #646669;
  font-family: 'Roboto Mono', monospace;
  display: flex;
  justify-content: center;
  align-items: center;
}

.container {
  display: flex;
  gap: 60px;
  width: 90%;
  max-width: 1200px;
  align-items: flex-start;
}

.left-col {
  flex: 2;
  display: flex;
  flex-direction: column;
}

.right-col {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 20px;
}

#title {
  font-weight: 700;
  font-size: 1.5rem;
  color: #3b82f6;
  margin-bottom: 1.5rem;
}

#text-to-type {
  font-size: 1.6rem;
  line-height: 1.5;
  color: #4b5563;
  margin-bottom: 2rem;
  word-spacing: 0.5rem;
  user-select: none;
}

.correct {
  color: #10b981;
  text-shadow: 0 0 2px rgba(16, 185, 129, 0.3);
}

.incorrect {
  color: #ef4444;
  text-decoration: underline;
}

#typing-input {
  width: 100%;
  font-family: 'Roboto Mono', monospace;
  font-size: 1.4rem;
  padding: 12px;
  background: #1f2937;
  border: 2px solid #374151;
  border-radius: 6px;
  color: #f3f4f6;
  outline: none;
  box-sizing: border-box;
  transition: all 0.3s ease;
}

#typing-input:focus {
  border-color: #3b82f6;
}

#typing-input:disabled {
  background: #111827;
  border-color: #10b981;
  color: #6b7280;
  cursor: not-allowed;
}

.stats-container {
  background: #1f2937;
  border-radius: 6px;
  padding: 20px;
  border: 1px solid #374151;
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.stats-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.stat-label {
  font-size: 0.9rem;
  color: #9ca3af;
}

.stat-val {
  font-size: 1.5rem;
  font-weight: 700;
  color: #3b82f6;
}

#high-score {
  color: #eab308;
}

button {
  width: 100%;
  padding: 12px;
  font-family: 'Roboto Mono', monospace;
  font-size: 1rem;
  cursor: pointer;
  background: #3b82f6;
  color: #ffffff;
  border: none;
  border-radius: 4px;
  font-weight: 500;
  margin-top: 10px;
}

button:hover {
  background: #2563eb;
}

h3 {
  font-size: 0.9rem;
  color: #9ca3af;
  margin: 0 0 5px 0;
}

canvas {
  background: #1f2937;
  border-radius: 6px;
  border: 1px solid #374151;
  width: 100%;
}
</style>
</head>
<body>

<div class="container">
  
  <div class="left-col">
    <div id="title">Typing Test</div>
    <div id="text-to-type"></div>
    <input 
      id="typing-input" 
      placeholder="Start typing..." 
      autocomplete="off" 
      autocorrect="off" 
      autocapitalize="off" 
      spellcheck="false" 
    />
  </div>

  <div class="right-col">
    <div class="stats-container">
      <div class="stats-row">
        <span class="stat-label">Current WPM</span>
        <span class="stat-val" id="wpm">0</span>
      </div>
      <div class="stats-row">
        <span class="stat-label">Accuracy</span>
        <span class="stat-val" id="accuracy">0%</span>
      </div>
      <div class="stats-row" style="margin-top: 10px; border-top: 1px solid #374151; padding-top: 10px;">
        <span class="stat-label">Best WPM</span>
        <span class="stat-val" id="high-score">0</span>
      </div>
      <button id="downloadCSV">Download CSV</button>
    </div>

    <div>
      <h3>Speed</h3>
      <canvas id="chartSpeed" width="300" height="150"></canvas>
    </div>

    <div>
      <h3>Accuracy</h3>
      <canvas id="chartAcc" width="300" height="150"></canvas>
    </div>
  </div>

</div>

<script src="words.js"></script>
<script>
const wordsList = (typeof words !== 'undefined' ? words : ["hello","world","code","test","java","script"]);
const textDisplay = document.getElementById('text-to-type');
const input = document.getElementById('typing-input');
const wpmDisplay = document.getElementById('wpm');
const accDisplay = document.getElementById('accuracy');
const highScoreDisplay = document.getElementById('high-score');
const speedCtx = document.getElementById('chartSpeed').getContext('2d');
const accCtx = document.getElementById('chartAcc').getContext('2d');

let bestScore = localStorage.getItem('bestWpm') || 0;
highScoreDisplay.textContent = bestScore;

let text = "";
for(let i=0; i<50; i++) {
  text += wordsList[Math.floor(Math.random() * wordsList.length)] + " ";
}
text = text.trim();

text.split('').forEach(char => {
  let span = document.createElement('span');
  span.innerText = char;
  textDisplay.appendChild(span);
});

let startTime = null;
let timer = null;
let data = [];
let isDone = false;

input.oninput = () => {
  if(!startTime) {
    startTime = new Date();
    timer = setInterval(update, 500);
  }
  
  const val = input.value;
  const spans = textDisplay.querySelectorAll('span');

  spans.forEach((span, i) => {
    if(i < val.length) {
      span.className = (val[i] === text[i]) ? 'correct' : 'incorrect';
    } else {
      span.className = '';
    }
  });

  if(val.length >= text.length && !isDone) {
    isDone = true;
    clearInterval(timer);
    input.disabled = true;
    update();
    
    let finalWpm = parseInt(wpmDisplay.innerText);
    if(finalWpm > bestScore) {
      localStorage.setItem('bestWpm', finalWpm);
      highScoreDisplay.innerText = finalWpm + " (New!)";
      highScoreDisplay.style.color = "#10b981";
    }
  }
};

function update() {
  const val = input.value;
  const mins = (new Date() - startTime) / 60000;
  
  if(mins > 0 && val.length > 0) {
    const wpm = Math.round((val.length / 5) / mins);
    const correct = val.split('').filter((c, i) => c === text[i]).length;
    const acc = Math.round((correct / val.length) * 100);

    wpmDisplay.innerText = wpm;
    accDisplay.innerText = acc + "%";
    
    data.push({ wpm, acc });
    draw(speedCtx, 'wpm', '#3b82f6');
    draw(accCtx, 'acc', '#10b981');
  }
}

function draw(ctx, key, color) {
  ctx.clearRect(0, 0, 300, 150);
  ctx.beginPath();
  ctx.strokeStyle = color;
  ctx.lineWidth = 2;

  const showData = data.slice(-50);
  const max = Math.max(...showData.map(d => d[key]), 10);

  showData.forEach((d, i) => {
    const x = i * (300 / 50);
    const y = 150 - (d[key] / max) * 140;
    if(i===0) ctx.moveTo(x, y);
    else ctx.lineTo(x, y);
  });
  ctx.stroke();
}

document.getElementById('downloadCSV').onclick = () => {
  let csv = "Time,WPM,Accuracy\n" + data.map((d, i) => `${i*0.5},${d.wpm},${d.acc}`).join("\n");
  let link = document.createElement('a');
  link.href = URL.createObjectURL(new Blob([csv], {type: 'text/csv'}));
  link.download = 'results.csv';
  link.click();
};
</script>

</body>
</html>